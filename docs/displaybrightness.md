# DisplayBrightness Analysis

## Overview
DisplayBrightness is a global variable in MechWarrior 2 that controls the screen brightness by selecting which gamma correction table to use when rendering colors. It serves as an index into a 2D lookup table that transforms RGB color values.

## Variable Details
- **Address**: 0x100a9468
- **Type**: 32-bit integer
- **Current Value**: 9
- **Valid Range**: 0-15 (0x0-0xF)
- **Shadow Copy**: DAT_100a946c (0x100a946c)

## Related Functions

### SimMain (0x10066a50)
Initializes DisplayBrightness from configuration data:
```c
DisplayBrightness = Mw2SndCfgData->displayBrightness;
_DAT_1012b7c0 = 0;
DAT_100a946c = DisplayBrightness;
```

### CopyPaletteColorWithBrightness (0x100584fc)
Uses DisplayBrightness to select a row in the gamma table when adjusting RGB values:
```c
void __cdecl CopyPaletteColorWithBrightness(PaletteColor *srcColor, PaletteColor *dstColor)
{
  int displayBrightness;
  
  displayBrightness = DisplayBrightness;
  dstColor->r = (&DAT_100e99a0)[(uint)srcColor->r + DisplayBrightness * 0x40];
  dstColor->g = (&DAT_100e99a0)[(uint)srcColor->g + displayBrightness * 0x40];
  dstColor->b = (&DAT_100e99a0)[(uint)srcColor->b + displayBrightness * 0x40];
  return;
}
```

### FUN_100584c6 (0x100584c6)
Temporarily sets DisplayBrightness to a new value, calls a palette function, then restores the original value:
```c
void __cdecl FUN_100584c6(undefined4 param_1)
{
  undefined4 uVar1;
  
  uVar1 = DisplayBrightness;
  DisplayBrightness = param_1;
  (*(code *)CurrentDrawModeExtension->someFunction1)(PaletteColorsPreBrightness);
  DisplayBrightness = uVar1;
  return;
}
```

### FUN_1007464f (0x1007464f)
Updates DisplayBrightness, its shadow copy, and the configuration data:
```c
void __cdecl FUN_1007464f(undefined4 param_1, int param_2)
{
  DisplayBrightness = FUN_10003580(param_2, 0xf);
  DAT_100a946c = DisplayBrightness;
  Mw2SndCfgData->displayBrightness = DisplayBrightness;
  FUN_100584c6(DisplayBrightness);
  return;
}
```

### FUN_10074693 (0x10074693)
Copies DisplayBrightness to its shadow copy and calls FUN_100584c6:
```c
void FUN_10074693(void)
{
  DAT_100a946c = DisplayBrightness;
  FUN_100584c6(DisplayBrightness);
  return;
}
```

### FUN_100745e0 (0x100745e0)
Uses DisplayBrightness in a fixed-point calculation:
```c
void FUN_100745e0(void)
{
  int iVar1;
  
  iVar1 = FUN_10002c90(1, 0xf);
  FUN_10003580(DisplayBrightness << 0x10, iVar1);
  return;
}
```

### generate_gammas (0x10058400)
Populates the gamma correction table at DAT_100e99a0 (0x100e99a0):
```c
void __fastcall generate_gammas(int param_1)
{
  float10 fVar1;
  longlong lVar2;
  int local_14;
  int local_10;
  
  for (local_14 = 0; local_14 < 0x10; local_14 = local_14 + 1) {
    for (local_10 = 0; local_10 < 0x40; local_10 = local_10 + 1) {
      fVar1 = (float10)FUN_10082962(param_1);
      lVar2 = __ftol((double)(fVar1 * (float10)63.0));
      (&DAT_100e99a0)[local_10 + local_14 * 0x40] = (char)lVar2;
      param_1 = local_10;
    }
  }
  return;
}
```

### FUN_10082962 (0x10082962)
A wrapper for the power function used in gamma calculations:
```c
void __fastcall FUN_10082962(undefined4 param_1)
{
  __cintrindisp2(param_1, 0x100bb73a);
  return;
}
```

### StartPalettes (0x10002a75)
Sets up palette-related variables, including possibly brightness-related globals:
```c
// At the end of the function:
DAT_100a00d0 = 0x10;  // 0x100a00d0
DAT_100a00dc = 0x10;  // 0x100a00dc
```

## Implementation Details

1. The game maintains a 2D gamma correction table at address 0x100e99a0
   - 16 rows (brightness levels 0-15)
   - 64 columns (color values 0-63)
   - Generated by the `generate_gammas` function using a power function

2. When adjusting colors in `CopyPaletteColorWithBrightness`:
   - DisplayBrightness * 0x40 selects the row (brightness level)
   - srcColor->r/g/b selects the column (original color value)
   - The result is the gamma-corrected color value

3. DisplayBrightness is loaded from configuration data (Mw2SndCfgData->displayBrightness) during game initialization in SimMain

4. A shadow copy is maintained at DAT_100a946c (0x100a946c), which is updated whenever DisplayBrightness changes

## Conclusion

DisplayBrightness is a critical display setting that affects the visual appearance of the game by controlling gamma correction. It's initialized from configuration data and can be modified during gameplay. The value is used as an index into a pre-calculated gamma correction table that transforms RGB color values to adjust the overall brightness of the display.

The implementation uses a sophisticated approach with a pre-calculated gamma table (rather than computing gamma corrections on-the-fly) for performance reasons, which was important for games in the mid-1990s when MechWarrior 2 was released. The use of 16 discrete brightness levels (0-15) provides a reasonable range of adjustment while keeping the lookup table size manageable.